# Automatically generated by Updater v1.0
# @author Daniel J. Finnegan

cmake_minimum_required (VERSION 2.8)
cmake_policy (SET CMP0048 NEW)

project (
	PDF-Concatenation-Tool
	VERSION
		1.0
	LANGUAGES
		NONE
)

# Change this to whatever you want to call your built application
# It will also set the name of the product installer built with NSIS
set (
	OUTPUT_PDF_FILENAME
		main
)

## Call the conversion utility
add_subdirectory (
	utils
)

# Find the essential package
find_package (
	LATEX
	COMPONENTS
		PDFLATEX
)

# Set and create a directory for dumping output files to
set (
	OUTPUT_DIR
		output
)

if (NOT EXISTS src/${OUTPUT_DIR})

	file (
		MAKE_DIRECTORY
			src/${OUTPUT_DIR}
	)

endif ()


# Set a name for the main file; this should actually be the same as the main input tex file
set (
	SOURCE_FILE
		main
)

# Simply do a pdflatex pass, followed by a bibtex pass, followed by two more pdflatex passes
add_custom_target (
	main_first_pass
	ALL
	DEPENDS
		gen_pdfs
	COMMAND
		${PDFLATEX_COMPILER} --output-directory bin/${OUTPUT_DIR} src/${SOURCE_FILE}.tex
	WORKING_DIRECTORY
		${CMAKE_SOURCE_DIR}
	COMMENT
		"Executing the first pdflatex pass..."
	VERBATIM
)

# Cleanup just involves deleting the output directory and placing the pdf into the bin directory
add_custom_target (
	make_pdf
	ALL
	COMMAND
		${CMAKE_COMMAND} -E make_directory ${CMAKE_SOURCE_DIR}/build
	COMMAND
		${CMAKE_COMMAND} -E copy bin/${OUTPUT_DIR}/${SOURCE_FILE}.pdf ${CMAKE_SOURCE_DIR}/build/${OUTPUT_PDF_FILENAME}.pdf
	COMMAND
		${CMAKE_COMMAND} -E remove_directory ${OUTPUT_DIR}
	WORKING_DIRECTORY
		${CMAKE_SOURCE_DIR}
	COMMENT
		"Cleaning up and packaging the pdf into the output directory..."
	VERBATIM
)

add_dependencies (
	make_pdf
	main_first_pass
)

add_dependencies (
	main_first_pass
	write_tex_file
)
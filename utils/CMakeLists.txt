# Automatically generated by Updater v1.0
# @author Daniel J. Finnegan

cmake_minimum_required (VERSION 2.8)
cmake_policy (SET CMP0048 NEW)

project (
    Docx2PDF
    VERSION
        0.1
    LANGUAGES
        NONE
)

option (
    USE_FILE_LIST
    "Use the input file list to specify which documents to convert"
    OFF
)

option (
    SKIP_CONVERSION
    "Skip the conversion step and just concatenate PDFs"
    OFF
)

option (
    USE_SPEC_PAGES
    "Concatenate specific pages of each PDF"
    OFF
)

if (USE_FILE_LIST)

message (
    STATUS
    "Getting the list of files from ./input/file_list.txt..."
)

file (
    TOUCH
    ${CMAKE_SOURCE_DIR}/input/file_list.txt
)

file (
    STRINGS
    ${CMAKE_SOURCE_DIR}/input/file_list.txt
    FILES_TO_CONVERT
)

if (USE_SPEC_PAGES)

message (
    STATUS
    "Preparing the input json file from ./input/file_spec.csv"
)

endif ()

else ()

message (
    STATUS
    "Using all files located in ./input/..."
)

if (SKIP_CONVERSION)

## Automatic usage through all files in the directory
file (
    GLOB
    FILES_TO_CONVERT
    LIST_DIRECTORIES
        false
    ${CMAKE_SOURCE_DIR}/input/*.pdf
)

else () # if (SKIP_CONVERSION)

## Automatic usage through all files in the directory
file (
    GLOB
    FILES_TO_CONVERT
    LIST_DIRECTORIES
        false
    ${CMAKE_SOURCE_DIR}/input/*.doc*
)

endif () # if (SKIP_CONVERSION)

endif () # if (USE_FILE_LIST)

message (
    STATUS
    "Files to convert: ${FILES_TO_CONVERT}"
)

#message (
#    FATAL_ERROR
#    "Check print"
#)

list (
    LENGTH
    FILES_TO_CONVERT
    NUM_FILES_TO_CONVERT
)

if (NUM_FILES_TO_CONVERT GREATER 0)

# Find the essential package
find_package (
    PythonInterp
)

if (SKIP_CONVERSION)

message (
    STATUS
    "Skipping the conversion process..."
)

if (USE_SPEC_PAGES)

# We call the python script and pass in the file names for conversion
add_custom_target (
    write_tex_file
    DEPENDS
        create_json_file
    COMMAND
        ${PYTHON_EXECUTABLE} utils/pdf_concatenate.py --working-directory=${CMAKE_SOURCE_DIR} --pdf-directory=input --use-json-spec ${FILES_TO_CONVERT}
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Writing the tex file..."
)

## Create the target here to create the json file
add_custom_target (
    create_json_file
    COMMAND
        ${PYTHON_EXECUTABLE} utils/use_json_spec.py --working-directory=${CMAKE_SOURCE_DIR} --spec-directory=input
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Creating the json file for specifying pages..."
)

else ()

# We call the python script and pass in the file names for conversion
add_custom_target (
    write_tex_file
    ALL
    COMMAND
        ${PYTHON_EXECUTABLE} utils/pdf_concatenate.py --working-directory=${CMAKE_SOURCE_DIR} --pdf-directory=input ${FILES_TO_CONVERT}
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Writing the tex file..."
)

endif () # if (USE_SPEC_PAGES)

else () # if (SKIP_CONVERSION)

if (USE_SPEC_PAGES)

# We call the python script and pass in the file names for conversion
add_custom_target (
    write_tex_file
    DEPENDS
        create_json_file
    COMMAND
        ${PYTHON_EXECUTABLE} utils/pdf_concatenate.py --working-directory=${CMAKE_SOURCE_DIR} --pdf-directory=input --use-json-spec ${FILES_TO_CONVERT}
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Writing the tex file..."
)

## Create the target here to create the json file
add_custom_target (
    create_json_file
    COMMAND
        ${PYTHON_EXECUTABLE} utils/use_json_spec.py --working-directory=${CMAKE_SOURCE_DIR} --spec-directory=input
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Creating the json file for specifying pages..."
)

else ()

# We call the python script and pass in the file names for conversion
add_custom_target (
    write_tex_file
    ALL
    COMMAND
        ${PYTHON_EXECUTABLE} utils/pdf_concatenate.py --working-directory=${CMAKE_SOURCE_DIR} --pdf-directory=build ${FILES_TO_CONVERT}
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Writing the tex file..."
)

endif ()

# We call the python script and pass in the file names for conversion
add_custom_target (
    gen_pdfs
    DEPENDS
        write_tex_file
    COMMAND
        ${PYTHON_EXECUTABLE} utils/docx_to_pdf.py --working-directory=${CMAKE_SOURCE_DIR} --output-directory=build ${FILES_TO_CONVERT}
    WORKING_DIRECTORY
        ${CMAKE_SOURCE_DIR}
    COMMENT
        "Converting the docx files to pdfs..."
)

endif () # if (SKIP_CONVERSION)

else () # if (NUM_FILES_TO_CONVERT GREATER 0)

message (
    FATAL_ERROR
    "Please specify at least one filename in the input file list"
)

endif () # if (NUM_FILES_TO_CONVERT GREATER 0)

